AWSTemplateFormatVersion: "2010-09-09"
Description: "Index"
Parameters:
  CfBaseUrl:
    Type: String
    Description: Autogenerated. The CF base url of templates
  CfBucket:
    Type: String
    Description: Autogenerated. The name of the S3 CF bucket
  CfBranch:
    Type: String
    Description: Autogenerated. The deployment branch.
  CfTs:
    Type: String
    Description: Autogenerated. The timestamp of the deployment.
  OpsEmail:
    Type: String
    Description: An email to send alerts. Not used right now.
  FrontendBucketName:
    Type: String
    Description: The bucket where frontend code will be loaded.
  DomainName:
    Type: String
    Description: The root domain of the webpage. Should be created in Route53.
  FrontendDomain:
    Type: String
      Description: The domain or subdomain where the frontend will be published.
  DomainHostedZoneId:
    Type: String
    Description: The hosted zone ID of the root domain of the webpage.
Resources:
  Domain:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub '${CfBaseUrl}domain/index.yaml'
      Parameters:
        CfBaseUrl: !Ref CfBaseUrl
        CfBucket: !Ref CfBucket
        CfBranch: !Ref CfBranch
        DomainHostedZoneId: !Ref DomainHostedZoneId
        FrontendDomain: !Ref FrontendDomain
        DomainName: !Ref DomainName
  Frontend:
    Type: AWS::CloudFormation::Stack
    DependsOn: Domain
    Properties:
      TemplateURL: !Sub '${CfBaseUrl}frontend/index.yaml'
      Parameters:
        CfTs: !Ref CfTs
        CfBaseUrl: !Ref CfBaseUrl
        CfBucket: !Ref CfBucket
        CfBranch: !Ref CfBranch
        OpsEmail: !Ref OpsEmail
        BucketName: !Ref FrontendBucketName
        FrontendDomain: !Ref FrontendDomain
        FrontendDomainCertificateArn: !GetAtt Domain.Outputs.FrontendDomainCertificateArn
        FrontendDomainHostedZoneId: !Ref DomainHostedZoneId

